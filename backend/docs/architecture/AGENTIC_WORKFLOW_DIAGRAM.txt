â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    AGENTIC RAG WORKFLOW DIAGRAM                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER INPUT                                      â”‚
â”‚  ğŸ“¸ Product Image + ğŸ’° Budget (e.g., 50 TND) + ğŸª Market (e.g., Carrefour) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        IMAGE PROCESSING PIPELINE                             â”‚
â”‚                                                                              â”‚
â”‚  1. SigLIP â†’ Image Embedding (768-dim)                                      â”‚
â”‚  2. OCR â†’ Extract text (brand, flavor, size)                                â”‚
â”‚  3. VLM â†’ Generate caption + detect category                                â”‚
â”‚  4. Text Embedding â†’ Embed OCR + VLM (384-dim â†’ 768-dim)                   â”‚
â”‚  5. Hybrid Embedding â†’ 60% visual + 40% text                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ğŸ¤– AGENT ORCHESTRATOR                                  â•‘
â•‘                   (Multi-Step Reasoning Engine)                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DatabaseQuery   â”‚ â”‚   Calculator     â”‚ â”‚ PriceAnalysis    â”‚
â”‚      Tool        â”‚ â”‚      Tool        â”‚ â”‚      Tool        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STEP 1: DATABASE QUERY TOOL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Search Strategy:                                                          â”‚
â”‚   â€¢ Hybrid Search (image + text) in selected market                         â”‚
â”‚   â€¢ Hybrid Search across ALL markets (for comparison)                       â”‚
â”‚   â€¢ Fallback to SQLite if Qdrant fails                                      â”‚
â”‚                                                                              â”‚
â”‚ ğŸ“Š Results:                                                                  â”‚
â”‚   â€¢ Found 10 products in Carrefour                                          â”‚
â”‚   â€¢ Found 20 products across all markets                                    â”‚
â”‚                                                                              â”‚
â”‚ ğŸ’¡ Reasoning:                                                                â”‚
â”‚   "Using hybrid search (visual + text: 'yaourt danone')"                    â”‚
â”‚                                                                              â”‚
â”‚ â¡ï¸  Next Steps:                                                              â”‚
â”‚   â€¢ Analyze budget                                                           â”‚
â”‚   â€¢ Find cheaper alternatives                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
STEP 2: CALCULATOR TOOL (Budget Analysis)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Budget Analysis:                                                          â”‚
â”‚   â€¢ Total products: 10                                                       â”‚
â”‚   â€¢ Within budget (â‰¤50 TND): 6 products                                     â”‚
â”‚   â€¢ Over budget (>50 TND): 4 products                                       â”‚
â”‚   â€¢ Price range: 2.50 - 8.00 TND                                            â”‚
â”‚   â€¢ Average price: 4.75 TND                                                 â”‚
â”‚                                                                              â”‚
â”‚ ğŸ’¡ Reasoning:                                                                â”‚
â”‚   "Found 6 products within budget (4 over budget). Price range: 2.50 - 8.00"â”‚
â”‚                                                                              â”‚
â”‚ â¡ï¸  Next Steps:                                                              â”‚
â”‚   â€¢ Get best match                                                           â”‚
â”‚   â€¢ Calculate optimal quantity                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
STEP 3: CALCULATOR TOOL (Quantity Suggestion)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Quantity Logic:                                                           â”‚
â”‚   â€¢ Best match: Danone Yogurt - 3.50 TND                                    â”‚
â”‚   â€¢ Product price: 3.50 TND (7% of budget)                                  â”‚
â”‚   â€¢ Max affordable: 14 units                                                â”‚
â”‚                                                                              â”‚
â”‚ ğŸ§® Smart Calculation:                                                        â”‚
â”‚   IF price < 30% of budget:                                                 â”‚
â”‚     â†’ Suggest bulk (2-6 units)                                              â”‚
â”‚   ELSE IF price â‰¤ budget:                                                   â”‚
â”‚     â†’ Suggest 1 unit                                                        â”‚
â”‚   ELSE:                                                                      â”‚
â”‚     â†’ Find alternatives                                                      â”‚
â”‚                                                                              â”‚
â”‚ âœ… Suggestion:                                                               â”‚
â”‚   â€¢ Quantity: 6 units                                                       â”‚
â”‚   â€¢ Reasoning: "6-pack (bulk savings)"                                      â”‚
â”‚   â€¢ Total: 21.00 TND                                                        â”‚
â”‚   â€¢ Within budget: âœ“ Yes                                                    â”‚
â”‚                                                                              â”‚
â”‚ ğŸ’¡ Reasoning:                                                                â”‚
â”‚   "Suggest 6 units (6-pack bulk savings) for 21.00 TND"                     â”‚
â”‚                                                                              â”‚
â”‚ â¡ï¸  Next Steps:                                                              â”‚
â”‚   â€¢ Find cheaper alternatives                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
STEP 4: PRICE ANALYSIS TOOL (Find Alternatives)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Cross-Market Search:                                                      â”‚
â”‚   â€¢ Search all markets for similar products                                 â”‚
â”‚   â€¢ Filter by similarity (>70%)                                             â”‚
â”‚   â€¢ Filter by price (cheaper than current)                                  â”‚
â”‚   â€¢ Calculate savings                                                        â”‚
â”‚                                                                              â”‚
â”‚ ğŸ’° Alternatives Found:                                                       â”‚
â”‚   1. Danone Yogurt at Aziza                                                 â”‚
â”‚      â€¢ Price: 3.20 TND                                                      â”‚
â”‚      â€¢ Savings: 0.30 TND per unit (8.6% cheaper)                            â”‚
â”‚      â€¢ Similarity: 85%                                                      â”‚
â”‚                                                                              â”‚
â”‚   2. Danone Yogurt at MG                                                    â”‚
â”‚      â€¢ Price: 3.00 TND                                                      â”‚
â”‚      â€¢ Savings: 0.50 TND per unit (14.3% cheaper)                           â”‚
â”‚      â€¢ Similarity: 82%                                                      â”‚
â”‚                                                                              â”‚
â”‚ ğŸ’¡ Reasoning:                                                                â”‚
â”‚   "Found 2 cheaper alternatives. Best saves 0.50 TND (14.3%)"               â”‚
â”‚                                                                              â”‚
â”‚ â¡ï¸  Next Steps:                                                              â”‚
â”‚   â€¢ Generate recommendation                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
STEP 5: GENERATE RECOMMENDATION (Groq AI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI Recommendation:                                                        â”‚
â”‚                                                                              â”‚
â”‚   "Get 6x Danone Yogurt for 21.00 TND (6-pack bulk savings). This is       â”‚
â”‚    within your 50 TND budget. However, you can save 3.00 TND by buying     â”‚
â”‚    the same product at MG for 18.00 TND total. Consider switching markets  â”‚
â”‚    for better value!"                                                       â”‚
â”‚                                                                              â”‚
â”‚ ğŸ“Š Summary:                                                                  â”‚
â”‚   â€¢ Product: Danone Yogurt Strawberry 125g                                  â”‚
â”‚   â€¢ Quantity: 6 units (bulk savings)                                        â”‚
â”‚   â€¢ Price at Carrefour: 21.00 TND âœ“                                         â”‚
â”‚   â€¢ Best alternative: MG at 18.00 TND (save 3.00 TND)                       â”‚
â”‚   â€¢ Match confidence: 87%                                                   â”‚
â”‚                                                                              â”‚
â”‚ ğŸ”— Reasoning Chain:                                                          â”‚
â”‚   1. "Using hybrid search (visual + text: 'yaourt danone')"                 â”‚
â”‚   2. "Found 6 products within budget (4 over budget)"                       â”‚
â”‚   3. "Suggest 6 units (6-pack bulk savings) for 21.00 TND"                  â”‚
â”‚   4. "Found 2 cheaper alternatives. Best saves 0.50 TND (14.3%)"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FINAL RESPONSE                                     â”‚
â”‚                                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    "product": {...},                                                         â”‚
â”‚    "quantity_suggestion": {                                                  â”‚
â”‚      "quantity": 6,                                                          â”‚
â”‚      "reasoning": "6-pack (bulk savings)",                                   â”‚
â”‚      "total_price": 21.00,                                                   â”‚
â”‚      "within_budget": true                                                   â”‚
â”‚    },                                                                        â”‚
â”‚    "alternatives": [                                                         â”‚
â”‚      {                                                                       â”‚
â”‚        "product": {...},                                                     â”‚
â”‚        "savings": 0.50,                                                      â”‚
â”‚        "percentage_cheaper": 14.3,                                           â”‚
â”‚        "market": "MG"                                                        â”‚
â”‚      }                                                                       â”‚
â”‚    ],                                                                        â”‚
â”‚    "recommendation": "Get 6x Danone Yogurt for 21.00 TND...",               â”‚
â”‚    "reasoning_chain": [...],                                                 â”‚
â”‚    "execution_log": [...]                                                    â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY FEATURES:

âœ… Multi-Step Reasoning: 5 steps with feedback loops
âœ… Tool-Based Architecture: Database, Calculator, Price Analysis
âœ… Budget-Aware: Analyzes affordability at every step
âœ… Smart Quantity: Suggests bulk purchases for savings
âœ… Cross-Market Comparison: Finds best deals automatically
âœ… Transparent Reasoning: Full execution log provided
âœ… Lightweight: No heavy MCP overhead
âœ… Fast: 2-3 seconds per query

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FEEDBACK LOOPS:

Each tool provides feedback that guides the next step:

DatabaseQueryTool â†’ "Found products" â†’ CalculatorTool
CalculatorTool â†’ "Budget analysis complete" â†’ QuantitySuggestion
QuantitySuggestion â†’ "Quantity calculated" â†’ PriceAnalysisTool
PriceAnalysisTool â†’ "Alternatives found" â†’ GenerateRecommendation

This creates an intelligent, adaptive workflow that makes smart decisions
based on the results of each step.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
